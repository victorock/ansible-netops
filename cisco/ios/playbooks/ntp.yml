- name: "NTP Provisioning"
  hosts: ios
  connection: network_cli
  gather_facts: no

  vars:

    ntp_source_interface: mgmt0
    ntp_servers:
      - 0.europe.pool.ntp.org
      - 1.europe.pool.ntp.org
      - 2.europe.pool.ntp.org

  tasks:
    - name: "Configure NTP source"
      ios_config:
        lines:
          - ntp source {{ ntp_source_interface }}

    - name: "Configure NTP server"
      ios_config:
        lines:
          - ntp server {{ ntp_server }}
      with_items: "{{ ntp_servers | default([]) }}"
      loop_control:
        loop_var: ntp_server
        label: "ntp_server {{ ntp_server }}"
